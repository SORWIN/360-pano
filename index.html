<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>360 панорама</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core@5.14.3/index.css">
  <style>html,body,#viewer{height:100%;margin:0;background:#111}</style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.183.0/build/three.module.js",
      "@photo-sphere-viewer/core": "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core@5.14.3/dist/photo-sphere-viewer.module.js",
      "@photo-sphere-viewer/gyroscope-plugin": "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/gyroscope-plugin@5.14.3/dist/index.module.js"
    }
  }
  </script>
</head>
<body>
  <div id="viewer"></div>

  <script type="module">
    import { Viewer } from "@photo-sphere-viewer/core";
    import { GyroscopePlugin } from "@photo-sphere-viewer/gyroscope-plugin";

    const viewer = new Viewer({
      container: document.getElementById('viewer'),
      panorama: 'panorama_4096x2048.jpg',
      navbar: ['zoom','fullscreen'],
      plugins: [GyroscopePlugin],
    });

    const gyro = viewer.getPlugin(GyroscopePlugin);

    document.body.addEventListener('click', async () => {
      if (typeof DeviceMotionEvent?.requestPermission === 'function') {
        try { await DeviceMotionEvent.requestPermission(); } catch {}
      }
      if (typeof DeviceOrientationEvent?.requestPermission === 'function') {
        try { await DeviceOrientationEvent.requestPermission(); } catch {}
      }
      try { await gyro.start(); } catch(e){ console.log(e); }
    }, {once:true});
  </script>
</body>
</html>
